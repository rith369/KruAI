// ==================== TRANSLATIONS ====================
const translations = {
    en: {
        survey_title: "Let's Build Your Perfect Study Plan! ğŸ¯",
        survey_desc: "Answer 4 questions to get your personalized roadmap",
        target_grade: "What grade do you want for Bac II?",
        months_left: "How many months until Bac II?",
        math_level: "How is your Math?",
        bio_level: "How is your Biology?",
        create_plan: "ğŸš€ Create My Plan",
        
        strong: "Strong ğŸ’ª",
        okay: "Okay ğŸ‘Œ",
        weak: "Weak - Need Help ğŸ˜°",
        
        your_plan: "Your Personalized Plan Created!",
        to_reach: "To reach Grade",
        study: "Study",
        per_day: "per day",
        complete: "Complete",
        sections_day: "sections/day",
        maintain_streak: "to maintain streak",
        total: "Total",
        sections_total: "sections to master",
        start_learning: "Start Learning",
        
        back: "Back",
        next: "Next",
        continue: "Continue",
        home: "Home",
        
        roadmap_title: "My Learning Roadmap ğŸ—ºï¸",
        today_challenge: "TODAY'S CHALLENGE",
        challenge_met: "âœ… Challenge complete! Streak maintained! ğŸ”¥",
        more_to_go: "more sections to go",
        day_streak: "day",
        days_streak: "days",
        
        countdown_title: "Bac II Countdown",
        days_left: "days",
        
        exam_prob: "exam probability",
        correct: "âœ“ Correct!",
        incorrect: "âœ— Not quite right",
        
        review_flashcards: "Review Flashcards",
        tap_to_flip: "Tap to flip",
        card: "Card",
        section_complete: "Section Complete! ğŸ‰",
        section_mastered: "Section Mastered! +50 XP",
        daily_progress: "Daily Progress",
        
        nav_home: "Home",
        nav_roadmap: "Roadmap",
        nav_cards: "Cards",
        nav_exam: "Exam",
        nav_more: "More",
        
        progress: "Overall Progress",
        
        // Mock Exam
        mock_exam: "Mock Bac II Exam",
        mock_desc: "Practice test with questions from all topics",
        questions: "Questions",
        start_exam: "Start Exam",
        finish_exam: "Finish Exam",
        exam_complete: "Exam Complete!",
        your_score: "Your Score",
        
        // AI Coach
        ai_coach: "AI Study Coach ğŸ¤–",
        ai_desc: "Click a question below for instant answers!",
        suggested_questions: "Suggested Questions",
        ask_custom: "Ask Your Own Question",
        requires_internet: "Custom questions require internet connection",
        answer: "Answer"
    },
    km: {
        survey_title: "ááŸ„áŸ‡á”á„áŸ’á€á¾áá•áŸ‚á“á€á¶ášáŸá·á€áŸ’áŸá¶á›áŸ’á¢á”áŸ†á•á»á! ğŸ¯",
        survey_desc: "á†áŸ’á›á¾á™áŸáŸ†áá½áš 4 áŠá¾á˜áŸ’á”á¸á‘á‘á½á›á•áŸ‚á“á€á¶ášá•áŸ’á‘á¶á›áŸ‹ááŸ’á›á½á“",
        target_grade: "áá¾á¢áŸ’á“á€á…á„áŸ‹á”á¶á“á–á·á“áŸ’á‘á»á”áŸ‰á»á“áŸ’á˜á¶á“áŸá˜áŸ’ášá¶á”áŸ‹ Bac II?",
        months_left: "á“áŸ…áŸá›áŸ‹á”áŸ‰á»á“áŸ’á˜á¶á“ááŸ‚áŠá›áŸ‹ Bac II?",
        math_level: "á‚áá·ááœá·á‘áŸ’á™á¶ášá”áŸáŸ‹á¢áŸ’á“á€á™áŸ‰á¶á„áŠá¼á…á˜áŸ’ááŸá…?",
        bio_level: "á‡á¸áœáœá·á‘áŸ’á™á¶ášá”áŸáŸ‹á¢áŸ’á“á€á™áŸ‰á¶á„áŠá¼á…á˜áŸ’ááŸá…?",
        create_plan: "ğŸš€ á”á„áŸ’á€á¾áá•áŸ‚á“á€á¶ášášá”áŸáŸ‹ááŸ’á‰á»áŸ†",
        
        strong: "ááŸ’á›á¶áŸ†á„ ğŸ’ª",
        okay: "á˜á’áŸ’á™á˜ ğŸ‘Œ",
        weak: "ááŸ’áŸáŸ„á™ - ááŸ’ášá¼áœá€á¶ášá‡áŸ†á“á½á™ ğŸ˜°",
        
        your_plan: "á•áŸ‚á“á€á¶ášá•áŸ’á‘á¶á›áŸ‹ááŸ’á›á½á“ášá”áŸáŸ‹á¢áŸ’á“á€á”á¶á“á”á„áŸ’á€á¾á!",
        to_reach: "áŠá¾á˜áŸ’á”á¸á‘áŸ…áŠá›áŸ‹á–á·á“áŸ’á‘á»",
        study: "áŸá·á€áŸ’áŸá¶",
        per_day: "á€áŸ’á“á»á„á˜á½á™ááŸ’á„áŸƒ",
        complete: "á”á‰áŸ’á…á”áŸ‹",
        sections_day: "á•áŸ’á“áŸ‚á€/ááŸ’á„áŸƒ",
        maintain_streak: "ášá€áŸ’áŸá¶á‡á½áš",
        total: "áŸášá»á”",
        sections_total: "á•áŸ’á“áŸ‚á€ááŸ’ášá¼áœá–á¼á€áŸ‚",
        start_learning: "á…á¶á”áŸ‹á•áŸ’áá¾á˜ášáŸ€á“",
        
        back: "áá™á€áŸ’ášáŸ„á™",
        next: "á”á“áŸ’á‘á¶á”áŸ‹",
        continue: "á”á“áŸ’á",
        home: "á‘áŸ†á–áŸášáŠá¾á˜",
        
        roadmap_title: "á•áŸ‚á“á€á¶ášáŸá·á€áŸ’áŸá¶ášá”áŸáŸ‹ááŸ’á‰á»áŸ† ğŸ—ºï¸",
        today_challenge: "á€á¶ášá”áŸ’ášá€á½áá”áŸ’ášá‡áŸ‚á„ááŸ’á„áŸƒá“áŸáŸ‡",
        challenge_met: "âœ… á”áŸ’ášá€á½áá”áŸ’ášá‡áŸ‚á„ášá½á…ášá¶á›áŸ‹! ášá€áŸ’áŸá¶á‡á½áš! ğŸ”¥",
        more_to_go: "á•áŸ’á“áŸ‚á€á‘áŸ€á",
        day_streak: "ááŸ’á„áŸƒ",
        days_streak: "ááŸ’á„áŸƒ",
        
        countdown_title: "á€á¶ášášá¶á”áŸ‹áá™á€áŸ’ášáŸ„á™ Bac II",
        days_left: "ááŸ’á„áŸƒ",
        
        exam_prob: "á”áŸ’ášá¼á”á¶á”áŸŠá¸á›á¸ááŸá”áŸ’ášá›á„",
        correct: "âœ“ ááŸ’ášá¹á˜ááŸ’ášá¼áœ!",
        incorrect: "âœ— á˜á·á“á‘á¶á“áŸ‹ááŸ’ášá¹á˜ááŸ’ášá¼áœá‘áŸ",
        
        review_flashcards: "á–á·á“á·ááŸ’á™á€á¶á",
        tap_to_flip: "á”áŸ‰áŸ‡áŠá¾á˜áŸ’á”á¸ááŸ’ášá¡á”áŸ‹",
        card: "á€á¶á",
        section_complete: "á•áŸ’á“áŸ‚á€ášá½á…ášá¶á›áŸ‹! ğŸ‰",
        section_mastered: "á•áŸ’á“áŸ‚á€á–á¼á€áŸ‚! +50 XP",
        daily_progress: "á€á¶ášáœá·áœáŒáŸ’áá“áŸá”áŸ’ášá…á¶áŸ†ááŸ’á„áŸƒ",
        
        nav_home: "á‘áŸ†á–áŸášáŠá¾á˜",
        nav_roadmap: "á•áŸ‚á“á€á¶áš",
        nav_cards: "á€á¶á",
        nav_exam: "á”áŸ’ášá›á„",
        nav_more: "á…áŸ’ášá¾á“á‘áŸ€á",
        
        progress: "á€á¶ášáœá·áœáŒáŸ’áá“áŸáŸášá»á”",
        
        // Mock Exam
        mock_exam: "á”áŸ’ášá›á„ Bac II áŸá¶á€á›áŸ’á”á„",
        mock_desc: "á”áŸ’ášá›á„á¢á“á»áœááŸ’áá‡á¶á˜á½á™áŸáŸ†áá½ášá–á¸á”áŸ’ášá’á¶á“á”á‘á‘á¶áŸ†á„á¢áŸáŸ‹",
        questions: "áŸáŸ†áá½áš",
        start_exam: "á…á¶á”áŸ‹á•áŸ’áá¾á˜á”áŸ’ášá›á„",
        finish_exam: "á”á‰áŸ’á…á”áŸ‹á”áŸ’ášá›á„",
        exam_complete: "á”áŸ’ášá›á„ášá½á…ášá¶á›áŸ‹!",
        your_score: "á–á·á“áŸ’á‘á»ášá”áŸáŸ‹á¢áŸ’á“á€",
        
        // AI Coach
        ai_coach: "á‚áŸ’ášá¼á”á„áŸ’ášáŸ€á“ AI ğŸ¤–",
        ai_desc: "á…á»á…áŸáŸ†áá½ášáá¶á„á€áŸ’ášáŸ„á˜áŸá˜áŸ’ášá¶á”áŸ‹á…á˜áŸ’á›á¾á™á—áŸ’á›á¶á˜áŸ—!",
        suggested_questions: "áŸáŸ†áá½ášá•áŸ’áá›áŸ‹á‡á¼á“",
        ask_custom: "áŸá½ášáŸáŸ†áá½ášášá”áŸáŸ‹á¢áŸ’á“á€á•áŸ’á‘á¶á›áŸ‹",
        requires_internet: "áŸáŸ†áá½ášá•áŸ’á‘á¶á›áŸ‹ááŸ’á›á½á“ááŸ’ášá¼áœá€á¶ášá¢áŸŠá¸á“á’áºáá·á",
        answer: "á…á˜áŸ’á›á¾á™"
    }
};

// ==================== CURRICULUM (All 4 Lessons Complete) ====================
const lessons = {
    math_limits: {
        id: 'math_limits',
        title: { en: 'Limits in Calculus', km: 'á€á˜áŸ’ášá·áá€áŸ’á“á»á„ Calculus' },
        icon: 'ğŸ“',
        subject: 'math',
        sections: [
            {
                id: 0,
                name: { en: 'What are Limits?', km: 'Limits á‚áºá‡á¶á¢áŸ’áœá¸?' },
                prob: 25,
                slides: [
                    {
                        content: {
                            en: 'A **limit** describes what value a function approaches as the input gets closer to a certain point.\n\nThink of it like driving toward a stop sign. Even before you reach it, we can predict where you\'re heading. That\'s what a limit does!\n\n**Key Idea**: Limits care about the *journey* (getting close), not the *destination* (the exact point).',
                            km: '**Limit** á–ááŸŒá“á¶á¢áŸ†á–á¸áá˜áŸ’á›áŸƒáŠáŸ‚á›á¢á“á»á‚á˜á“áŸáá·áá‘áŸ…á‡á·á á“áŸ…á–áŸá›áŠáŸ‚á› input áá·áá‘áŸ…á‡á·áá…áŸ†áá»á…á˜á½á™áŸ”\n\ná‚á·áá–á¸áœá¶áŠá¼á…á€á¶ášá”á¾á€á”ášá‘áŸ…ášá€á•áŸ’á›á¼áœá…á¶ááŸ‹áŸ” á‘áŸ„áŸ‡á”á¸á˜á»á“á–áŸá›á¢áŸ’á“á€á‘áŸ…áŠá›áŸ‹ á™á¾á„á¢á¶á…á–áŸ’á™á¶á€ášááŸá”á¶á“áá¶á¢áŸ’á“á€á€áŸ†á–á»á„á‘áŸ…áá¶áŸ” á“áŸ„áŸ‡á‚áºá‡á¶á¢áŸ’áœá¸áŠáŸ‚á› limit á’áŸ’áœá¾!\n\n**á‚áŸ†á“á·ááŸáŸ†áá¶á“áŸ‹**: Limits á™á€á…á·ááŸ’áá‘á»á€áŠá¶á€áŸ‹á›á¾ *áŠáŸ†áá¾ášá€á¶áš* (á‘áŸ…á‡á·á) á˜á·á“á˜áŸ‚á“ *á‚áŸ„á›áŠáŸ…* (á…áŸ†áá»á…á–á·áá”áŸ’ášá¶á€áŠ) á‘áŸáŸ”'
                        },
                        question: {
                            text: { en: 'What does a limit describe?', km: 'Limit á–ááŸŒá“á¶á¢áŸ†á–á¸á¢áŸ’áœá¸?' },
                            options: {
                                en: ['The exact value at a point', 'The value a function approaches', 'The maximum value possible'],
                                km: ['áá˜áŸ’á›áŸƒá–á·áá”áŸ’ášá¶á€áŠá“áŸ…á…áŸ†áá»á…', 'áá˜áŸ’á›áŸƒáŠáŸ‚á›á¢á“á»á‚á˜á“áŸáá·áá‘áŸ…á‡á·á', 'áá˜áŸ’á›áŸƒá¢áá·á”ášá˜á¶']
                            },
                            correct: 1,
                            explain: {
                                en: 'Limits show the value approached, not necessarily the exact value at the point!',
                                km: 'Limits á”á„áŸ’á á¶á‰áá˜áŸ’á›áŸƒáŠáŸ‚á›áá·áá‘áŸ…á‡á·á á˜á·á“á˜áŸ‚á“áá˜áŸ’á›áŸƒá–á·áá”áŸ’ášá¶á€áŠá“áŸ…á…áŸ†áá»á…á“áŸ„áŸ‡á‘áŸ!'
                            }
                        }
                    },
                    {
                        content: {
                            en: 'We write limits like this:\n\n**lim (xâ†’2) f(x) = 5**\n\nRead as: "The limit of f(x) as x approaches 2 equals 5"\n\n**What it means**:\n- As x gets closer to 2...\n- f(x) gets closer to 5\n\n**Example**: lim (xâ†’2) (3x + 1) = ?\nWhen x = 2: 3(2) + 1 = 7\nSo the limit is 7 âœ“',
                            km: 'á™á¾á„áŸášáŸáŸáš limits áŠá¼á…á“áŸáŸ‡:\n\n**lim (xâ†’2) f(x) = 5**\n\ná¢á¶á“áá¶: "Limit á“áŸƒ f(x) á“áŸ…á–áŸá› x áá·áá‘áŸ… 2 áŸáŸ’á˜á¾ 5"\n\n**á¢ááŸ’áá“áŸá™**:\n- á“áŸ…á–áŸá› x áá·áá‘áŸ…á‡á·á 2...\n- f(x) áá·áá‘áŸ…á‡á·á 5\n\n**á§á‘á¶á ášááŸ**: lim (xâ†’2) (3x + 1) = ?\ná“áŸ…á–áŸá› x = 2: 3(2) + 1 = 7\náŠá¼á…áŸ’á“áŸáŸ‡ limit á‚áº 7 âœ“'
                        },
                        question: {
                            text: { en: 'What does lim (xâ†’3) f(x) = 7 mean?', km: 'lim (xâ†’3) f(x) = 7 á˜á¶á“á“áŸá™áá¶á˜áŸ’ááŸá…?' },
                            options: {
                                en: ['f(3) must equal 7', 'As x approaches 3, f(x) approaches 7', 'x equals 3'],
                                km: ['f(3) ááŸ’ášá¼áœááŸ‚áŸáŸ’á˜á¾ 7', 'á“áŸ…á–áŸá› x áá·áá‘áŸ… 3, f(x) áá·áá‘áŸ… 7', 'x áŸáŸ’á˜á¾ 3']
                            },
                            correct: 1,
                            explain: {
                                en: 'Limit notation tells us about the approach, not the exact value!',
                                km: 'á“á·á˜á·ááŸ’ááŸá‰áŸ’á‰á¶ Limit á”áŸ’ášá¶á”áŸ‹á™á¾á„á¢áŸ†á–á¸á€á¶ášáá·áá‘áŸ…á‡á·á á˜á·á“á˜áŸ‚á“áá˜áŸ’á›áŸƒá–á·áá”áŸ’ášá¶á€áŠá‘áŸ!'
                            }
                        }
                    }
                ],
                flashcards: [
                    {
                        front: { en: 'What is a limit?', km: 'Limit á‚áºá‡á¶á¢áŸ’áœá¸?' },
                        back: { en: 'The value a function approaches as input gets closer to a point', km: 'áá˜áŸ’á›áŸƒáŠáŸ‚á›á¢á“á»á‚á˜á“áŸáá·áá‘áŸ…á‡á·á á“áŸ…á–áŸá› input áá·áá‘áŸ…á‡á·áá…áŸ†áá»á…' }
                    },
                    {
                        front: { en: 'lim (xâ†’a) f(x) = L means?', km: 'lim (xâ†’a) f(x) = L á˜á¶á“á“áŸá™áá¶á˜áŸ’ááŸá…?' },
                        back: { en: 'As x approaches a, f(x) approaches L', km: 'á“áŸ…á–áŸá› x áá·áá‘áŸ… a, f(x) áá·áá‘áŸ… L' }
                    },
                    {
                        front: { en: 'Key idea about limits?', km: 'á‚áŸ†á“á·ááŸáŸ†áá¶á“áŸ‹á¢áŸ†á–á¸ limits?' },
                        back: { en: 'Care about the journey (approach), not destination (exact point)', km: 'á™á€á…á·ááŸ’áá‘á»á€áŠá¶á€áŸ‹á›á¾áŠáŸ†áá¾ášá€á¶áš á˜á·á“á˜áŸ‚á“á‚áŸ„á›áŠáŸ…á‘áŸ' }
                    }
                ]
            },
            {
                id: 1,
                name: { en: 'One-Sided Limits', km: 'Limits á˜áŸ’áá¶á„' },
                prob: 40,
                slides: [
                    {
                        content: {
                            en: 'We can approach a point from different directions!\n\n**Left-hand limit**: lim (xâ†’aâ») f(x)\n- Approach from the LEFT (smaller values)\n- Example: approaching 5 from 4.9, 4.99, 4.999...\n\n**Right-hand limit**: lim (xâ†’aâº) f(x)\n- Approach from the RIGHT (larger values)\n- Example: approaching 5 from 5.1, 5.01, 5.001...',
                            km: 'á™á¾á„á¢á¶á…áá·áá‘áŸ…á‡á·áá…áŸ†áá»á…á˜á½á™á–á¸á‘á·áŸá•áŸ’áŸáŸá„áŸ—á‚áŸ’á“á¶!\n\n**Limit áá¶á„á†áŸ’áœáŸá„**: lim (xâ†’aâ») f(x)\n- áá·áá‘áŸ…á–á¸áá¶á„á†áŸ’áœáŸá„ (áá˜áŸ’á›áŸƒáá¼á…)\n- á§á‘á¶á ášááŸ: áá·áá‘áŸ… 5 á–á¸ 4.9, 4.99, 4.999...\n\n**Limit áá¶á„áŸáŸ’áá¶áŸ†**: lim (xâ†’aâº) f(x)\n- áá·áá‘áŸ…á–á¸áá¶á„áŸáŸ’áá¶áŸ† (áá˜áŸ’á›áŸƒá’áŸ†)\n- á§á‘á¶á ášááŸ: áá·áá‘áŸ… 5 á–á¸ 5.1, 5.01, 5.001...'
                        },
                        question: {
                            text: { en: 'When does a two-sided limit exist?', km: 'á“áŸ…á–áŸá›áá¶ limit á–á¸ášáá¶á„á˜á¶á“?' },
                            options: {
                                en: ['Always exists', 'When left and right limits are equal', 'Never exists'],
                                km: ['á˜á¶á“á‡á¶á“á·á…áŸ’á…', 'á“áŸ…á–áŸá› limits á†áŸ’áœáŸá„ á“á·á„ áŸáŸ’áá¶áŸ† áŸáŸ’á˜á¾á‚áŸ’á“á¶', 'á˜á·á“áŠáŸ‚á›á˜á¶á“']
                            },
                            correct: 1,
                            explain: {
                                en: 'Two-sided limit exists ONLY if both one-sided limits are equal!',
                                km: 'Limit á–á¸ášáá¶á„ á˜á¶á“ááŸ‚á“áŸ…á–áŸá› limits á˜áŸ’áá¶á„á‘á¶áŸ†á„á–á¸ášáŸáŸ’á˜á¾á‚áŸ’á“á¶!'
                            }
                        }
                    }
                ],
                flashcards: [
                    {
                        front: { en: 'lim (xâ†’aâ») means?', km: 'lim (xâ†’aâ») á˜á¶á“á“áŸá™áá¶á˜áŸ’ááŸá…?' },
                        back: { en: 'Approach from LEFT (smaller values)', km: 'áá·áá‘áŸ…á–á¸á†áŸ’áœáŸá„ (áá˜áŸ’á›áŸƒáá¼á…)' }
                    },
                    {
                        front: { en: 'lim (xâ†’aâº) means?', km: 'lim (xâ†’aâº) á˜á¶á“á“áŸá™áá¶á˜áŸ’ááŸá…?' },
                        back: { en: 'Approach from RIGHT (larger values)', km: 'áá·áá‘áŸ…á–á¸áŸáŸ’áá¶áŸ† (áá˜áŸ’á›áŸƒá’áŸ†)' }
                    }
                ]
            }
        ]
    },
    
    math_probability: {
        id: 'math_probability',
        title: { en: 'Basic Probability', km: 'á”áŸ’ášá¼á”á¶á”áŸŠá¸á›á¸ááŸá˜á¼á›áŠáŸ’á‹á¶á“' },
        icon: 'ğŸ²',
        subject: 'math',
        sections: [
            {
                id: 0,
                name: { en: 'What is Probability?', km: 'Probability á‚áºá‡á¶á¢áŸ’áœá¸?' },
                prob: 28,
                slides: [
                    {
                        content: {
                            en: '**Probability** measures how likely something is to happen.\n\n**Formula**: P(Event) = Favorable outcomes / Total outcomes\n\n**Example**: Flipping a coin\n- Favorable (getting heads) = 1\n- Total outcomes = 2 (heads or tails)\n- P(Heads) = 1/2 = 0.5 = 50%\n\n**Key**: Probability is always between 0 and 1!',
                            km: '**Probability** áœá¶áŸáŸ‹áŸáŸ’á‘á„áŸ‹áá¶áá¾á¢áŸ’áœá¸á˜á½á™á‘áŸ†á“á„á‡á¶á€á¾áá¡á¾á„áŸ”\n\n**ášá¼á”á˜á“áŸ’á**: P(á–áŸ’ášá¹ááŸ’áá·á€á¶ášááŸ) = á›á‘áŸ’á’á•á›á¢áŸ†ááŸ„á™á•á› / á›á‘áŸ’á’á•á›áŸášá»á”\n\n**á§á‘á¶á ášááŸ**: á”áŸ„áŸ‡á€á¶á€áŸ‹\n- á¢áŸ†ááŸ„á™á•á› (á‘á‘á½á›á”á¶á“á€áŸ’á”á¶á›) = 1\n- á›á‘áŸ’á’á•á›áŸášá»á” = 2 (á€áŸ’á”á¶á› á¬ á€á“áŸ’á‘á»á™)\n- P(á€áŸ’á”á¶á›) = 1/2 = 0.5 = 50%\n\n**áŸáŸ†áá¶á“áŸ‹**: Probability á‚áºášáœá¶á„ 0 á“á·á„ 1 á‡á¶á“á·á…áŸ’á…!'
                        },
                        question: {
                            text: { en: 'What is the probability formula?', km: 'ášá¼á”á˜á“áŸ’á probability á‚áºá‡á¶á¢áŸ’áœá¸?' },
                            options: {
                                en: ['P = Total / Favorable', 'P = Favorable / Total', 'P = Favorable Ã— Total'],
                                km: ['P = áŸášá»á” / á¢áŸ†ááŸ„á™á•á›', 'P = á¢áŸ†ááŸ„á™á•á› / áŸášá»á”', 'P = á¢áŸ†ááŸ„á™á•á› Ã— áŸášá»á”']
                            },
                            correct: 1,
                            explain: {
                                en: 'Probability = Favorable outcomes divided by Total outcomes!',
                                km: 'Probability = á›á‘áŸ’á’á•á›á¢áŸ†ááŸ„á™á•á› á…áŸ‚á€áŠáŸ„á™ á›á‘áŸ’á’á•á›áŸášá»á”!'
                            }
                        }
                    },
                    {
                        content: {
                            en: '**Sample Space** = All possible outcomes\n\n**Example**: Rolling a die\n- Sample Space = {1, 2, 3, 4, 5, 6}\n- Total outcomes = 6\n\n**Example**: Rolling an even number\n- Event = {2, 4, 6}\n- Favorable outcomes = 3\n- P(even) = 3/6 = 1/2',
                            km: '**Sample Space** = á›á‘áŸ’á’á•á›áŠáŸ‚á›á¢á¶á…á€á¾áá˜á¶á“á‘á¶áŸ†á„á¢áŸáŸ‹\n\n**á§á‘á¶á ášááŸ**: á‚á”áŸ‹á‚á¼á\n- Sample Space = {1, 2, 3, 4, 5, 6}\n- á›á‘áŸ’á’á•á›áŸášá»á” = 6\n\n**á§á‘á¶á ášááŸ**: á‚á”áŸ‹á›áŸáá‚á¼\n- á–áŸ’ášá¹ááŸ’áá·á€á¶ášááŸ = {2, 4, 6}\n- á›á‘áŸ’á’á•á›á¢áŸ†ááŸ„á™á•á› = 3\n- P(á‚á¼) = 3/6 = 1/2'
                        },
                        question: {
                            text: { en: 'You roll a die. What is P(rolling > 4)?', km: 'á¢áŸ’á“á€á‚á”áŸ‹á‚á¼ááŸ” áá¾ P(á‚á”áŸ‹ > 4) á‚áºá”áŸ‰á»á“áŸ’á˜á¶á“?' },
                            options: {
                                en: ['1/6', '2/6 = 1/3', '3/6 = 1/2'],
                                km: ['1/6', '2/6 = 1/3', '3/6 = 1/2']
                            },
                            correct: 1,
                            explain: {
                                en: 'Numbers > 4 are {5, 6}. That\'s 2 favorable out of 6 total.',
                                km: 'á›áŸá > 4 á‚áº {5, 6}áŸ” á“áŸ„áŸ‡á‚áº 2 á¢áŸ†ááŸ„á™á•á› á€áŸ’á“á»á„á…áŸ†ááŸ„á˜ 6áŸ”'
                            }
                        }
                    }
                ],
                flashcards: [
                    { front: { en: 'Probability formula?', km: 'ášá¼á”á˜á“áŸ’á Probability?' }, back: { en: 'P = Favorable / Total', km: 'P = á¢áŸ†ááŸ„á™á•á› / áŸášá»á”' } },
                    { front: { en: 'What is sample space?', km: 'Sample space á‚áºá‡á¶á¢áŸ’áœá¸?' }, back: { en: 'All possible outcomes', km: 'á›á‘áŸ’á’á•á›áŠáŸ‚á›á¢á¶á…á€á¾áá˜á¶á“á‘á¶áŸ†á„á¢áŸáŸ‹' } },
                    { front: { en: 'Probability range?', km: 'á‡á½áš Probability?' }, back: { en: 'Always between 0 and 1', km: 'ášáœá¶á„ 0 á“á·á„ 1 á‡á¶á“á·á…áŸ’á…' } }
                ]
            }
        ]
    },
    
    biology_body: {
        id: 'biology_body',
        title: { en: 'Human Body Systems', km: 'á”áŸ’ášá–áŸá“áŸ’á’ášá¶á„á€á¶á™á˜á“á»áŸáŸ’áŸ' },
        icon: 'ğŸ«€',
        subject: 'biology',
        sections: [
            {
                id: 0,
                name: { en: '11 Body Systems', km: 'á”áŸ’ášá–áŸá“áŸ’á’ášá¶á„á€á¶á™ 11' },
                prob: 30,
                slides: [
                    {
                        content: {
                            en: 'Your body has **11 major systems** working together:\n\n1. **Skeletal** ğŸ¦´ - Bones (support)\n2. **Muscular** ğŸ’ª - Muscles (movement)\n3. **Nervous** ğŸ§  - Brain & nerves (control)\n4. **Circulatory** â¤ï¸ - Heart & blood (transport)\n5. **Respiratory** ğŸ« - Lungs (breathing)\n6. **Digestive** ğŸ½ï¸ - Stomach (nutrition)\n7. **Urinary** ğŸ’§ - Kidneys (waste)\n8. **Immune** ğŸ›¡ï¸ - Defense\n9. **Endocrine** âš—ï¸ - Hormones\n10. **Integumentary** ğŸ§´ - Skin\n11. **Reproductive** ğŸ‘¶ - Reproduction',
                            km: 'ášá¶á„á€á¶á™ášá”áŸáŸ‹á¢áŸ’á“á€á˜á¶á“ **á”áŸ’ášá–áŸá“áŸ’á’áŸáŸ†áá¶á“áŸ‹ 11** á’áŸ’áœá¾á€á¶ášá‡á¶á˜á½á™á‚áŸ’á“á¶:\n\n1. **á†áŸ’á¢á¹á„** ğŸ¦´ - á†áŸ’á¢á¹á„ (á‚á¶áŸ†á‘áŸ’áš)\n2. **áŸá¶á…áŸ‹áŠá»áŸ†** ğŸ’ª - áŸá¶á…áŸ‹áŠá»áŸ† (á…á›á“á¶)\n3. **áŸášáŸáŸƒá”áŸ’ášáŸá¶á‘** ğŸ§  - áá½ášá€áŸ’á”á¶á› & áŸášáŸáŸƒ (á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„)\n4. **áŸášáŸáŸƒáˆá¶á˜** â¤ï¸ - á”áŸáŸ‡áŠá¼á„ & áˆá¶á˜ (áŠá¹á€á‡á‰áŸ’á‡á¼á“)\n5. **áŠá„áŸ’á á¾á˜** ğŸ« - áŸá½á (áŠá€áŠá„áŸ’á á¾á˜)\n6. **ášáŸ†á›á¶á™á¢á¶á á¶áš** ğŸ½ï¸ - á€áŸ’ášá–áŸ‡ (á¢á¶á á¶ášá¼á”ááŸ’áá˜áŸ’á—)\n7. **á›á¶á˜á€** ğŸ’§ - áá˜áŸ’ášá„á“áŸ„á˜ (á€á¶á€áŸáŸ†áá›áŸ‹)\n8. **á—á¶á–áŸáŸŠá¶áŸ†** ğŸ›¡ï¸ - á€á¶ášá€á¶ášá–á¶áš\n9. **á¢áŸášá˜áŸ‰á¼á“** âš—ï¸ - á¢áŸášá˜áŸ‰á¼á“\n10. **áŸáŸ’á”áŸ‚á€** ğŸ§´ - áŸáŸ’á”áŸ‚á€\n11. **á”á“áŸ’áá–á¼á‡** ğŸ‘¶ - á€á¶ášá”á“áŸ’áá–á¼á‡'
                        },
                        question: {
                            text: { en: 'How many major organ systems does the body have?', km: 'ášá¶á„á€á¶á™á˜á¶á“á”áŸ’ášá–áŸá“áŸ’á’áŸášá¸ášá¶á„áŸ’á‚áŸáŸ†áá¶á“áŸ‹á”áŸ‰á»á“áŸ’á˜á¶á“?' },
                            options: {
                                en: ['9 systems', '11 systems', '13 systems'],
                                km: ['9 á”áŸ’ášá–áŸá“áŸ’á’', '11 á”áŸ’ášá–áŸá“áŸ’á’', '13 á”áŸ’ášá–áŸá“áŸ’á’']
                            },
                            correct: 1,
                            explain: {
                                en: 'The human body has 11 major organ systems!',
                                km: 'ášá¶á„á€á¶á™á˜á“á»áŸáŸ’áŸá˜á¶á“á”áŸ’ášá–áŸá“áŸ’á’áŸášá¸ášá¶á„áŸ’á‚áŸáŸ†áá¶á“áŸ‹ 11!'
                            }
                        }
                    },
                    {
                        content: {
                            en: '**Systems work together**\n\nWhen you exercise ğŸƒ:\n\n1. **Muscular** - Muscles need energy\n2. **Respiratory** - Breathe faster (more oxygen)\n3. **Circulatory** - Heart beats faster (deliver oxygen)\n4. **Nervous** - Coordinates everything\n5. **Integumentary** - You sweat (cool down)\n\nSee how they work as a team!',
                            km: '**á”áŸ’ášá–áŸá“áŸ’á’á’áŸ’áœá¾á€á¶ášá‡á¶á˜á½á™á‚áŸ’á“á¶**\n\ná“áŸ…á–áŸá›á¢áŸ’á“á€á’áŸ’áœá¾á›áŸ†á á¶ááŸ‹á”áŸ’ášá¶á ğŸƒ:\n\n1. **áŸá¶á…áŸ‹áŠá»áŸ†** - áŸá¶á…áŸ‹áŠá»áŸ†ááŸ’ášá¼áœá€á¶ášáá¶á˜á–á›\n2. **áŠá„áŸ’á á¾á˜** - áŠá€áŠá„áŸ’á á¾á˜á›á¿á“ (á¢á»á€áŸáŸŠá¸áŸáŸ‚á“á…áŸ’ášá¾á“)\n3. **áŸášáŸáŸƒáˆá¶á˜** - á”áŸáŸ‡áŠá¼á„áœá¶á™á›á¿á“ (á”á‰áŸ’á‡á¼á“á¢á»á€áŸáŸŠá¸áŸáŸ‚á“)\n4. **áŸášáŸáŸƒá”áŸ’ášáŸá¶á‘** - áŸá˜áŸ’ášá”áŸá˜áŸ’ášá½á›á‚áŸ’ášá”áŸ‹á™áŸ‰á¶á„\n5. **áŸáŸ’á”áŸ‚á€** - á¢áŸ’á“á€á”áŸ‚á€á‰á¾áŸ (á’áŸ’áœá¾á±áŸ’á™ááŸ’ášá‡á¶á€áŸ‹)\n\ná˜á¾á›áá¶á–á½á€áœá¶á’áŸ’áœá¾á€á¶ášá‡á¶á€áŸ’ášá»á˜!'
                        },
                        question: {
                            text: { en: 'Which system controls all body functions?', km: 'á”áŸ’ášá–áŸá“áŸ’á’áá¶á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á˜á»áá„á¶ášá‘á¶áŸ†á„á¢áŸáŸ‹?' },
                            options: {
                                en: ['Muscular system', 'Nervous system (brain, nerves)', 'Circulatory system'],
                                km: ['á”áŸ’ášá–áŸá“áŸ’á’áŸá¶á…áŸ‹áŠá»áŸ†', 'á”áŸ’ášá–áŸá“áŸ’á’áŸášáŸáŸƒá”áŸ’ášáŸá¶á‘ (áá½ášá€áŸ’á”á¶á›, áŸášáŸáŸƒ)', 'á”áŸ’ášá–áŸá“áŸ’á’áŸášáŸáŸƒáˆá¶á˜']
                            },
                            correct: 1,
                            explain: {
                                en: 'The nervous system controls and coordinates all body functions!',
                                km: 'á”áŸ’ášá–áŸá“áŸ’á’áŸášáŸáŸƒá”áŸ’ášáŸá¶á‘ á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á“á·á„áŸá˜áŸ’ášá”áŸá˜áŸ’ášá½á›á˜á»áá„á¶ášá‘á¶áŸ†á„á¢áŸáŸ‹!'
                            }
                        }
                    }
                ],
                flashcards: [
                    { front: { en: 'How many body systems?', km: 'á˜á¶á“á”áŸ’ášá–áŸá“áŸ’á’ášá¶á„á€á¶á™á”áŸ‰á»á“áŸ’á˜á¶á“?' }, back: { en: '11 major systems', km: 'á”áŸ’ášá–áŸá“áŸ’á’áŸáŸ†áá¶á“áŸ‹ 11' } },
                    { front: { en: 'Which controls body?', km: 'á¢áŸ’áœá¸á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„ášá¶á„á€á¶á™?' }, back: { en: 'Nervous system', km: 'á”áŸ’ášá–áŸá“áŸ’á’áŸášáŸáŸƒá”áŸ’ášáŸá¶á‘' } },
                    { front: { en: 'Circulatory system does?', km: 'á”áŸ’ášá–áŸá“áŸ’á’áŸášáŸáŸƒáˆá¶á˜á’áŸ’áœá¾á¢áŸ’áœá¸?' }, back: { en: 'Transports blood, oxygen', km: 'áŠá¹á€á‡á‰áŸ’á‡á¼á“áˆá¶á˜, á¢á»á€áŸáŸŠá¸áŸáŸ‚á“' } }
                ]
            }
        ]
    },
    
    biology_brain: {
        id: 'biology_brain',
        title: { en: 'The Human Brain', km: 'áá½ášá€áŸ’á”á¶á›á˜á“á»áŸáŸ’áŸ' },
        icon: 'ğŸ§ ',
        subject: 'biology',
        sections: [
            {
                id: 0,
                name: { en: 'Brain Structure', km: 'ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’áá½ášá€áŸ’á”á¶á›' },
                prob: 33,
                slides: [
                    {
                        content: {
                            en: 'The brain has **3 main parts**:\n\n**1. Cerebrum** (largest)\n- The "thinking brain"\n- Handles memory, thinking, senses\n- Split into left & right hemispheres\n\n**2. Cerebellum** ("little brain")\n- Coordinates movement & balance\n- At the back, below cerebrum\n\n**3. Brainstem**\n- Connects to spinal cord\n- Controls automatic functions (breathing, heartbeat)',
                            km: 'áá½ášá€áŸ’á”á¶á›á˜á¶á“ **á•áŸ’á“áŸ‚á€áŸáŸ†áá¶á“áŸ‹ 3**:\n\n**1. áá½ášá€áŸ’á”á¶á›á’áŸ†** (á’áŸ†á”áŸ†á•á»á)\n- "áá½ášá€áŸ’á”á¶á›á‚á·á"\n- á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á€á¶ášá…á„á…á¶áŸ†, á€á¶ášá‚á·á, á¢á¶ášá˜áŸ’á˜ááŸ\n- á”áŸ‚á„á…áŸ‚á€á‡á¶á¢áŒáŸ’áá‚áŸ„á›á†áŸ’áœáŸá„á“á·á„áŸáŸ’áá¶áŸ†\n\n**2. áá½ášá€áŸ’á”á¶á›áá¼á…** ("áá½ášá€áŸ’á”á¶á›áá¼á…")\n- áŸá˜áŸ’ášá”áŸá˜áŸ’ášá½á›á…á›á“á¶á“á·á„áá»á›áŸ’á™á—á¶á–\n- á“áŸ…áá¶á„á€áŸ’ášáŸ„á™, á€áŸ’ášáŸ„á˜áá½ášá€áŸ’á”á¶á›á’áŸ†\n\n**3. áŠá¾á˜áá½ášá€áŸ’á”á¶á›**\n- á—áŸ’á‡á¶á”áŸ‹á‘áŸ…ááŸ’áŸáŸ‚ášá†áŸ’á¢á¹á„ááŸ’á“á„\n- á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á˜á»áá„á¶ášáŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá· (áŠá„áŸ’á á¾á˜, á…á„áŸ’áœá¶á€áŸ‹á”áŸáŸ‡áŠá¼á„)'
                        },
                        question: {
                            text: { en: 'What are the 3 main brain parts?', km: 'áá¾á•áŸ’á“áŸ‚á€áŸáŸ†áá¶á“áŸ‹ 3 á“áŸƒáá½ášá€áŸ’á”á¶á›á‚áºá‡á¶á¢áŸ’áœá¸?' },
                            options: {
                                en: ['Cerebrum, Cerebellum, Brainstem', 'Left, Right, Center', 'Front, Back, Middle'],
                                km: ['áá½ášá€áŸ’á”á¶á›á’áŸ†, áá½ášá€áŸ’á”á¶á›áá¼á…, áŠá¾á˜áá½ášá€áŸ’á”á¶á›', 'á†áŸ’áœáŸá„, áŸáŸ’áá¶áŸ†, á€ááŸ’áá¶á›', 'á˜á»á, á€áŸ’ášáŸ„á™, á€ááŸ’áá¶á›']
                            },
                            correct: 0,
                            explain: {
                                en: 'Cerebrum (thinking), Cerebellum (movement), Brainstem (automatic)!',
                                km: 'áá½ášá€áŸ’á”á¶á›á’áŸ† (á‚á·á), áá½ášá€áŸ’á”á¶á›áá¼á… (á…á›á“á¶), áŠá¾á˜áá½ášá€áŸ’á”á¶á› (áŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá·)!'
                            }
                        }
                    },
                    {
                        content: {
                            en: 'The cerebrum has **4 lobes**:\n\n**Frontal Lobe** (Front) ğŸ¯\n- Personality, decisions, planning\n- Speech production\n\n**Parietal Lobe** (Top) âœ‹\n- Touch, temperature, pain\n- Spatial awareness\n\n**Temporal Lobe** (Sides) ğŸ‘‚\n- Hearing, language understanding\n- Memory formation\n\n**Occipital Lobe** (Back) ğŸ‘ï¸\n- Vision, color recognition\n- Reading',
                            km: 'áá½ášá€áŸ’á”á¶á›á’áŸ†á˜á¶á“ **á›áŸ„á” 4**:\n\n**á›áŸ„á”áá¶á„á˜á»á** (áá¶á„á˜á»á) ğŸ¯\n- á”á»á‚áŸ’á‚á›á·á€á›á€áŸ’áááŸˆ, á€á¶ášáŸá˜áŸ’ášáŸá…á…á·ááŸ’á, á€á¶ášášáŸ€á”á…áŸ†á•áŸ‚á“á€á¶áš\n- á€á¶ášá•á›á·áá€á¶ášá“á·á™á¶á™\n\n**á›áŸ„á”Parietal** (áá¶á„á›á¾) âœ‹\n- á€á¶ášá”áŸ‰áŸ‡, áŸá¸áá»ááŸ’á á—á¶á–, á€á¶ášáˆáºá…á¶á”áŸ‹\n- á€á¶ášá™á›áŸ‹áŠá¹á„á¢áŸ†á–á¸á›áŸ†á \n\n**á›áŸ„á”Temporal** (á…áŸ†á áŸ€á„) ğŸ‘‚\n- á€á¶ášáŸáŸ’áá¶á”áŸ‹, á€á¶ášá™á›áŸ‹á—á¶áŸá¶\n- á€á¶ášá”á„áŸ’á€á¾áá€á¶ášá…á„á…á¶áŸ†\n\n**á›áŸ„á”Occipital** (áá¶á„á€áŸ’ášáŸ„á™) ğŸ‘ï¸\n- á…á€áŸ’áá»áœá·áŸáŸá™, á€á¶ášáŸáŸ’á‚á¶á›áŸ‹á–ááŸŒ\n- á€á¶ášá¢á¶á“'
                        },
                        question: {
                            text: { en: 'Which lobe controls vision?', km: 'á›áŸ„á”áá¶á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á…á€áŸ’áá»áœá·áŸáŸá™?' },
                            options: {
                                en: ['Frontal lobe', 'Parietal lobe', 'Occipital lobe'],
                                km: ['á›áŸ„á”áá¶á„á˜á»á', 'á›áŸ„á”Parietal', 'á›áŸ„á”Occipital']
                            },
                            correct: 2,
                            explain: {
                                en: 'The occipital lobe (back of brain) processes all visual information!',
                                km: 'á›áŸ„á”Occipital (áá¶á„á€áŸ’ášáŸ„á™áá½ášá€áŸ’á”á¶á›) áŠáŸ†áá¾ášá€á¶ášá–áŸááŸŒá˜á¶á“á…á€áŸ’áá»áœá·áŸáŸá™á‘á¶áŸ†á„á¢áŸáŸ‹!'
                            }
                        }
                    }
                ],
                flashcards: [
                    { front: { en: '3 main brain parts?', km: 'á•áŸ’á“áŸ‚á€áŸáŸ†áá¶á“áŸ‹ 3 á“áŸƒáá½ášá€áŸ’á”á¶á›?' }, back: { en: 'Cerebrum, Cerebellum, Brainstem', km: 'áá½ášá€áŸ’á”á¶á›á’áŸ†, áá½ášá€áŸ’á”á¶á›áá¼á…, áŠá¾á˜áá½ášá€áŸ’á”á¶á›' } },
                    { front: { en: 'Which lobe = vision?', km: 'á›áŸ„á”áá¶ = á…á€áŸ’áá»áœá·áŸáŸá™?' }, back: { en: 'Occipital lobe (back)', km: 'á›áŸ„á”Occipital (áá¶á„á€áŸ’ášáŸ„á™)' } },
                    { front: { en: 'Frontal lobe controls?', km: 'á›áŸ„á”áá¶á„á˜á»á á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„?' }, back: { en: 'Personality, decisions', km: 'á”á»á‚áŸ’á‚á›á·á€á›á€áŸ’áááŸˆ, á€á¶ášáŸá˜áŸ’ášáŸá…á…á·ááŸ’á' } }
                ]
            }
        ]
    }
};

// ==================== STATE ====================
let state = {
    lang: 'en',
    surveyDone: false,
    profile: null,
    plan: null,
    currentScreen: 'survey',
    currentLesson: null,
    currentSection: 0,
    currentSlide: 0,
    showingFlashcards: false,
    flashcardIndex: 0,
    flashcardFlipped: false,
    completedSections: [],
    todayCompleted: 0,
    lastDate: new Date().toDateString(),
    xp: 0,
    streak: 1,
    daysUntilBacII: 92,
    mockExamStarted: false,
    mockExamCurrent: 0,
    mockExamScore: 0
};

function save() { localStorage.setItem('kruai', JSON.stringify(state)); }
function load() {
    const saved = localStorage.getItem('kruai');
    if (saved) {
        state = { ...state, ...JSON.parse(saved) };
        if (state.lastDate !== new Date().toDateString()) {
            state.todayCompleted = 0;
            state.lastDate = new Date().toDateString();
        }
    }
}
function t(key) { return translations[state.lang][key] || key; }

// ==================== SURVEY ====================
function renderSurvey() {
    return `
        <div class="card">
            <h1 class="card-title">${t('survey_title')}</h1>
            <p class="text-muted mb-3">${t('survey_desc')}</p>
            
            <div class="survey-question">
                <label>${t('target_grade')}</label>
                <select id="target-grade" class="survey-select">
                    <option value="A">A - Excellent</option>
                    <option value="B">B - Very Good</option>
                    <option value="C" selected>C - Good</option>
                    <option value="D">D - Pass</option>
                    <option value="E">E - Just Pass</option>
                </select>
            </div>

            <div class="survey-question">
                <label>${t('months_left')}</label>
                <select id="months-left" class="survey-select">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3" selected>3</option>
                    <option value="6">6</option>
                    <option value="12">12</option>
                </select>
            </div>

            <div class="survey-question">
                <label>${t('math_level')}</label>
                <select id="math-level" class="survey-select">
                    <option value="strong">${t('strong')}</option>
                    <option value="okay">${t('okay')}</option>
                    <option value="weak" selected>${t('weak')}</option>
                </select>
            </div>

            <div class="survey-question">
                <label>${t('bio_level')}</label>
                <select id="bio-level" class="survey-select">
                    <option value="strong">${t('strong')}</option>
                    <option value="okay">${t('okay')}</option>
                    <option value="weak" selected>${t('weak')}</option>
                </select>
            </div>

            <button class="btn btn-primary btn-block btn-lg" onclick="completeSurvey()">
                ${t('create_plan')}
            </button>
        </div>
    `;
}

function completeSurvey() {
    const targetGrade = document.getElementById('target-grade').value;
    const monthsLeft = parseInt(document.getElementById('months-left').value);
    const mathLevel = document.getElementById('math-level').value;
    const bioLevel = document.getElementById('bio-level').value;
    
    // AUTO-CALCULATE plan based on inputs
    let totalSections;
    if (targetGrade === 'A') totalSections = 24;
    else if (targetGrade === 'B') totalSections = 20;
    else if (targetGrade === 'C') totalSections = 16;
    else if (targetGrade === 'D') totalSections = 12;
    else totalSections = 8;
    
    if (mathLevel === 'weak') totalSections += 3;
    if (bioLevel === 'weak') totalSections += 3;
    
    const totalDays = monthsLeft * 30;
    const sectionsPerDay = Math.ceil(totalSections / totalDays);
    const hoursPerDay = (sectionsPerDay * 15 / 60).toFixed(1); // 15 min per section
    
    state.profile = { targetGrade, monthsLeft, mathLevel, bioLevel };
    state.plan = { totalSections, sectionsPerDay, hoursPerDay };
    state.surveyDone = true;
    state.currentScreen = 'home';
    save();
    render();
}

// ==================== HOME ====================
function renderHome() {
    const progress = (state.completedSections.length / state.plan.totalSections * 100).toFixed(0);
    const dailyProgress = (state.todayCompleted / state.plan.sectionsPerDay * 100).toFixed(0);
    const challengeMet = state.todayCompleted >= state.plan.sectionsPerDay;
    
    const motivations = {
        en: [
            "Every expert was once a beginner. Keep going! ğŸ’ª",
            "Your future self will thank you for studying today! ğŸŒŸ",
            "Small progress is still progress! ğŸ“ˆ",
            "Consistency beats perfection! ğŸ”¥"
        ],
        km: [
            "á¢áŸ’á“á€á‡áŸ†á“á¶á‰á‚áŸ’ášá”áŸ‹ášá¼á”á’áŸ’á›á¶á”áŸ‹á‡á¶á¢áŸ’á“á€á…á¶á”áŸ‹á•áŸ’áá¾á˜áŸ” á”á“áŸ’áá‘áŸ…á˜á»á! ğŸ’ª",
            "á¢á“á¶á‚áášá”áŸáŸ‹á¢áŸ’á“á€á“á¹á„ááŸ’á›áŸ‚á„á¢áŸ†áášá‚á»áá…áŸ†á–áŸ„áŸ‡á€á¶ášáŸá·á€áŸ’áŸá¶ááŸ’á„áŸƒá“áŸáŸ‡! ğŸŒŸ",
            "á€á¶ášášá¸á€á…á˜áŸ’ášá¾á“áá¼á…áŸ—á€áŸá“áŸ…ááŸ‚á‡á¶á€á¶ášášá¸á€á…á˜áŸ’ášá¾á“! ğŸ“ˆ",
            "á—á¶á–áŸáŸŠá¼á‘áŸ’ášá¶áŸ†á™á€áˆáŸ’á“áŸ‡á›á¾á—á¶á–á¥áááŸ’á…áŸ„áŸ‡! ğŸ”¥"
        ]
    };
    const todayMotivation = motivations[state.lang][new Date().getDate() % motivations[state.lang].length];
    
    return `
        <div class="card" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(245, 158, 11, 0.15));">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div style="font-size: 3rem;">â°</div>
                <div style="flex: 1;">
                    <div style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 0.25rem;">${t('countdown_title')}</div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--accent-gold);">${state.daysUntilBacII} ${t('days_left')}</div>
                </div>
            </div>
        </div>

        <div class="card" style="background: linear-gradient(135deg, rgba(6,182,212,0.15), rgba(167,139,250,0.15));">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ’ª</div>
            <div style="font-size: 1.1rem; font-weight: 500;">${todayMotivation}</div>
        </div>

        <div class="card">
            <h2 class="card-subtitle">${t('your_plan')}</h2>
            <div class="plan-grid">
                <div class="plan-item">
                    <div class="plan-label">${t('study')}</div>
                    <div class="plan-value">${state.plan.hoursPerDay}</div>
                    <div class="plan-unit">hr ${t('per_day')}</div>
                </div>
                <div class="plan-item">
                    <div class="plan-label">${t('complete')}</div>
                    <div class="plan-value">${state.plan.sectionsPerDay}</div>
                    <div class="plan-unit">${t('sections_day')}</div>
                </div>
                <div class="plan-item">
                    <div class="plan-label">${t('total')}</div>
                    <div class="plan-value">${state.plan.totalSections}</div>
                    <div class="plan-unit">${t('sections_total')}</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-subtitle">ğŸ“… ${t('today_challenge')}</h2>
            <div class="progress-bar-container">
                <div class="progress-bar-fill" style="width: ${dailyProgress}%"></div>
            </div>
            <p class="text-muted text-center mt-2">
                ${state.todayCompleted}/${state.plan.sectionsPerDay} ${challengeMet ? '- ' + t('challenge_met') : '- ' + (state.plan.sectionsPerDay - state.todayCompleted) + ' ' + t('more_to_go')}
            </p>
        </div>

        <div class="card">
            <h2 class="card-subtitle">${t('roadmap_title')}</h2>
            ${Object.values(lessons).map(lesson => {
                const completed = lesson.sections.filter(s => state.completedSections.includes(`${lesson.id}-${s.id}`)).length;
                const total = lesson.sections.length;
                const percent = (completed / total * 100).toFixed(0);
                
                return `
                    <div class="roadmap-item" onclick="startLesson('${lesson.id}')">
                        <div class="roadmap-header">
                            <div class="roadmap-title">${lesson.icon} ${lesson.title[state.lang]}</div>
                            <div>${completed}/${total}</div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
            }).join('')}
        </div>

        <div class="card">
            <h2 class="card-subtitle">ğŸ“Š ${t('progress')}</h2>
            <div class="progress-bar-container">
                <div class="progress-bar-fill" style="width: ${progress}%"></div>
            </div>
            <p class="text-muted text-center mt-2">${state.completedSections.length}/${state.plan.totalSections} â€¢ ${progress}%</p>
        </div>
    `;
}

function startLesson(id) {
    state.currentLesson = id;
    state.currentSection = 0;
    state.currentSlide = 0;
    state.showingFlashcards = false;
    state.currentScreen = 'learning';
    render();
}

// ==================== LEARNING (MIMO-STYLE) ====================
function renderLearning() {
    const lesson = lessons[state.currentLesson];
    const section = lesson.sections[state.currentSection];
    
    if (state.showingFlashcards) {
        return renderFlashcards(section);
    }
    
    const slide = section.slides[state.currentSlide];
    const totalSlides = section.slides.length;
    const progress = ((state.currentSlide + 1) / totalSlides * 100).toFixed(0);
    
    return `
        <div class="section-container">
            <div class="section-header">
                <button class="section-close" onclick="exitLearning()">âœ•</button>
                <div class="section-progress-container">
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: ${progress}%"></div>
                    </div>
                </div>
                <div class="section-counter">${state.currentSlide + 1}/${totalSlides}</div>
            </div>

            <div class="card">
                <div class="section-type">Section ${state.currentSection + 1}</div>
                <span class="section-probability">${section.prob}% ${t('exam_prob')}</span>
                <h2 class="card-title mt-2">${section.name[state.lang]}</h2>
                
                <div class="section-text">${slide.content[state.lang].replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</div>
                
                <div style="background: rgba(6, 182, 212, 0.08); padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0;">
                    <div style="font-size: 0.85rem; font-weight: 600; color: var(--accent-cyan); margin-bottom: 0.75rem;">ğŸ’¡ Quick Check:</div>
                    <div style="font-size: 1.05rem; font-weight: 600; margin-bottom: 1rem;">${slide.question.text[state.lang]}</div>
                    <div class="question-options" id="q-opts">
                        ${slide.question.options[state.lang].map((opt, idx) => `
                            <div class="option" onclick="answer(${idx}, ${slide.question.correct})" id="opt-${idx}">
                                ${opt}
                            </div>
                        `).join('')}
                    </div>
                    <div id="feedback"></div>
                </div>

                <button class="btn btn-primary btn-block btn-lg" id="next-btn" style="display:none;" onclick="nextSlide()">
                    ${t('next')} â†’
                </button>
            </div>
        </div>
    `;
}

function answer(selected, correct) {
    const isCorrect = selected === correct;
    const lesson = lessons[state.currentLesson];
    const section = lesson.sections[state.currentSection];
    const slide = section.slides[state.currentSlide];
    
    document.querySelectorAll('.option').forEach((opt, idx) => {
        opt.classList.add('disabled');
        if (idx === correct) opt.classList.add('correct');
        if (idx === selected && !isCorrect) opt.classList.add('incorrect');
    });
    
    const feedback = document.getElementById('feedback');
    feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
    feedback.innerHTML = `
        <div class="feedback-title">${isCorrect ? t('correct') : t('incorrect')}</div>
        <p>${slide.question.explain[state.lang]}</p>
    `;
    
    if (isCorrect) {
        state.xp += 10;
        showXP(10);
    }
    
    document.getElementById('next-btn').style.display = 'block';
}

function nextSlide() {
    const lesson = lessons[state.currentLesson];
    const section = lesson.sections[state.currentSection];
    
    state.currentSlide++;
    
    if (state.currentSlide >= section.slides.length) {
        // Show flashcards
        state.showingFlashcards = true;
        state.flashcardIndex = 0;
        state.flashcardFlipped = false;
    }
    
    render();
}

function renderFlashcards(section) {
    const card = section.flashcards[state.flashcardIndex];
    const text = state.flashcardFlipped ? card.back[state.lang] : card.front[state.lang];
    
    return `
        <div class="section-container">
            <div class="section-header">
                <button class="section-close" onclick="exitLearning()">âœ•</button>
                <div style="flex: 1; text-align: center; font-weight: 600; color: var(--accent-cyan);">
                    ${t('review_flashcards')}
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">${t('section_complete')}</h2>
                
                <div class="flashcard-container">
                    <div class="flashcard ${state.flashcardFlipped ? 'flipped' : ''}" onclick="flipCard()">
                        <div class="flashcard-face flashcard-front">
                            <div class="flashcard-text">${card.front[state.lang]}</div>
                            <div class="flashcard-hint">${t('tap_to_flip')}</div>
                        </div>
                        <div class="flashcard-face flashcard-back">
                            <div class="flashcard-text">${card.back[state.lang]}</div>
                            <div class="flashcard-hint">${t('tap_to_flip')}</div>
                        </div>
                    </div>
                </div>
                
                <p class="text-center text-muted mt-2">${t('card')} ${state.flashcardIndex + 1}/${section.flashcards.length}</p>
                
                <div class="flashcard-nav">
                    ${state.flashcardIndex > 0 ? `<button class="btn btn-secondary" onclick="prevFlashcard()">â† ${t('back')}</button>` : ''}
                    ${state.flashcardIndex < section.flashcards.length - 1 ? 
                        `<button class="btn btn-primary" onclick="nextFlashcard()">${t('next')} â†’</button>` :
                        `<button class="btn btn-primary btn-lg" onclick="completeSection()">${t('section_mastered')}</button>`
                    }
                </div>
            </div>
        </div>
    `;
}

function flipCard() {
    state.flashcardFlipped = !state.flashcardFlipped;
    render();
}

function prevFlashcard() {
    state.flashcardIndex--;
    state.flashcardFlipped = false;
    render();
}

function nextFlashcard() {
    state.flashcardIndex++;
    state.flashcardFlipped = false;
    state.xp += 5;
    showXP(5);
    render();
}

function completeSection() {
    const sectionKey = `${state.currentLesson}-${state.currentSection}`;
    if (!state.completedSections.includes(sectionKey)) {
        state.completedSections.push(sectionKey);
        state.todayCompleted++;
        state.xp += 50;
        showXP(50);
        
        // Check streak
        if (state.todayCompleted >= state.plan.sectionsPerDay) {
            const today = new Date().toDateString();
            if (state.lastDate !== today) {
                state.streak++;
                state.lastDate = today;
            }
        }
    }
    
    save();
    state.currentScreen = 'home';
    render();
}

function exitLearning() {
    state.currentScreen = 'home';
    render();
}

// ==================== MOCK EXAM ====================
function renderMockExam() {
    // Collect all questions from all lessons
    const allQuestions = [];
    Object.values(lessons).forEach(lesson => {
        lesson.sections.forEach(section => {
            section.slides.forEach(slide => {
                if (slide.question) {
                    allQuestions.push({
                        lessonTitle: lesson.title,
                        sectionName: section.name,
                        prob: section.prob,
                        ...slide.question
                    });
                }
            });
        });
    });
    
    if (!state.mockExamStarted) {
        return `
            <div class="card">
                <button class="btn btn-secondary mb-2" onclick="navigate('home')">â† ${t('back')}</button>
                <h1 class="card-title">ğŸ“ ${t('mock_exam')}</h1>
                <p class="text-muted mb-3">${t('mock_desc')}</p>
                
                <div class="plan-grid">
                    <div class="plan-item">
                        <div class="plan-label">${t('questions')}</div>
                        <div class="plan-value">${allQuestions.length}</div>
                    </div>
                    <div class="plan-item">
                        <div class="plan-label">Time</div>
                        <div class="plan-value">60</div>
                        <div class="plan-unit">min</div>
                    </div>
                </div>
                
                <button class="btn btn-primary btn-block btn-lg mt-2" onclick="startMockExam()">
                    ${t('start_exam')} â†’
                </button>
            </div>
        `;
    } else {
        const currentQ = allQuestions[state.mockExamCurrent];
        const progress = ((state.mockExamCurrent + 1) / allQuestions.length * 100).toFixed(0);
        
        return `
            <div class="section-container">
                <div class="section-header">
                    <button class="section-close" onclick="exitMockExam()">âœ•</button>
                    <div class="section-progress-container">
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    <div class="section-counter">${state.mockExamCurrent + 1}/${allQuestions.length}</div>
                </div>

                <div class="card">
                    <div class="section-type">${currentQ.lessonTitle[state.lang]}</div>
                    <span class="section-probability">${currentQ.prob}%</span>
                    
                    <h2 class="card-title mt-2">${currentQ.text[state.lang]}</h2>
                    
                    <div class="question-options" id="mock-opts">
                        ${currentQ.options[state.lang].map((opt, idx) => `
                            <div class="option" onclick="answerMockQuestion(${idx}, ${currentQ.correct})" id="mock-opt-${idx}">
                                ${opt}
                            </div>
                        `).join('')}
                    </div>
                    <div id="mock-feedback"></div>
                    
                    <button class="btn btn-primary btn-block btn-lg" id="mock-next" style="display:none;" onclick="nextMockQuestion()">
                        ${state.mockExamCurrent < allQuestions.length - 1 ? t('next') : t('finish_exam')} â†’
                    </button>
                </div>
            </div>
        `;
    }
}

function startMockExam() {
    state.mockExamStarted = true;
    state.mockExamCurrent = 0;
    state.mockExamScore = 0;
    render();
}

function answerMockQuestion(selected, correct) {
    const isCorrect = selected === correct;
    
    document.querySelectorAll('[id^="mock-opt-"]').forEach((opt, idx) => {
        opt.classList.add('disabled');
        if (idx === correct) opt.classList.add('correct');
        if (idx === selected && !isCorrect) opt.classList.add('incorrect');
    });
    
    if (isCorrect) {
        state.mockExamScore++;
        state.xp += 20;
        showXP(20);
    }
    
    document.getElementById('mock-next').style.display = 'block';
}

function nextMockQuestion() {
    state.mockExamCurrent++;
    
    const allQuestions = [];
    Object.values(lessons).forEach(lesson => {
        lesson.sections.forEach(section => {
            section.slides.forEach(slide => {
                if (slide.question) allQuestions.push(slide.question);
            });
        });
    });
    
    if (state.mockExamCurrent >= allQuestions.length) {
        finishMockExam(allQuestions.length);
    } else {
        render();
    }
}

function finishMockExam(total) {
    const percentage = Math.round((state.mockExamScore / total) * 100);
    state.xp += 100;
    showXP(100);
    state.mockExamStarted = false;
    save();
    
    alert(`${t('exam_complete')}\n\n${t('your_score')}: ${state.mockExamScore}/${total} (${percentage}%)\n\n+100 XP Bonus! ğŸ‰`);
    navigate('home');
}

function exitMockExam() {
    if (confirm('Exit exam? Progress will be lost.')) {
        state.mockExamStarted = false;
        navigate('home');
    }
}

// ==================== AI COACH ====================
function renderAICoach() {
    const suggestedQuestions = {
        en: [
            { q: "What is a limit in calculus?", a: "A limit describes the value a function approaches as the input gets closer to a certain point. It's about the journey (approaching), not the destination (exact point)." },
            { q: "How do I calculate probability?", a: "Use this formula: P(Event) = Favorable outcomes / Total outcomes. Example: Rolling a die, P(even) = 3/6 = 1/2." },
            { q: "What are the main parts of the brain?", a: "The brain has 3 main parts: Cerebrum (thinking, memory), Cerebellum (movement, balance), Brainstem (automatic functions like breathing)." },
            { q: "Which system controls the body?", a: "The nervous system (brain, spinal cord, nerves) controls all body functions. It's like the command center!" },
            { q: "How many organ systems does the body have?", a: "The human body has 11 major organ systems working together to keep you alive and healthy." }
        ],
        km: [
            { q: "Limit á€áŸ’á“á»á„ calculus á‚áºá‡á¶á¢áŸ’áœá¸?", a: "Limit á–ááŸŒá“á¶á¢áŸ†á–á¸áá˜áŸ’á›áŸƒáŠáŸ‚á›á¢á“á»á‚á˜á“áŸáá·áá‘áŸ…á‡á·á á“áŸ…á–áŸá› input áá·áá‘áŸ…á‡á·áá…áŸ†áá»á…á˜á½á™áŸ” áœá¶á™á€á…á·ááŸ’áá‘á»á€áŠá¶á€áŸ‹á›á¾áŠáŸ†áá¾ášá€á¶áš á˜á·á“á˜áŸ‚á“á‚áŸ„á›áŠáŸ…á‘áŸáŸ”" },
            { q: "á’áŸ’áœá¾áŠá¼á…á˜áŸ’ááŸá…á‚áá“á¶ probability?", a: "á”áŸ’ášá¾ášá¼á”á˜á“áŸ’áá“áŸáŸ‡: P(á–áŸ’ášá¹ááŸ’áá·á€á¶ášááŸ) = á›á‘áŸ’á’á•á›á¢áŸ†ááŸ„á™á•á› / á›á‘áŸ’á’á•á›áŸášá»á”áŸ” á§á‘á¶á ášááŸ: á‚á”áŸ‹á‚á¼á, P(á‚á¼) = 3/6 = 1/2áŸ”" },
            { q: "á•áŸ’á“áŸ‚á€áŸáŸ†áá¶á“áŸ‹á“áŸƒáá½ášá€áŸ’á”á¶á›á‚áºá‡á¶á¢áŸ’áœá¸?", a: "áá½ášá€áŸ’á”á¶á›á˜á¶á“á•áŸ’á“áŸ‚á€áŸáŸ†áá¶á“áŸ‹ 3: áá½ášá€áŸ’á”á¶á›á’áŸ† (á€á¶ášá‚á·á, á€á¶ášá…á„á…á¶áŸ†), áá½ášá€áŸ’á”á¶á›áá¼á… (á…á›á“á¶, áá»á›áŸ’á™á—á¶á–), áŠá¾á˜áá½ášá€áŸ’á”á¶á› (á˜á»áá„á¶ášáŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá·áŠá¼á…á‡á¶á€á¶ášáŠá€áŠá„áŸ’á á¾á˜)áŸ”" },
            { q: "á”áŸ’ášá–áŸá“áŸ’á’áá¶á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„ášá¶á„á€á¶á™?", a: "á”áŸ’ášá–áŸá“áŸ’á’áŸášáŸáŸƒá”áŸ’ášáŸá¶á‘ (áá½ášá€áŸ’á”á¶á›, ááŸ’áŸáŸ‚ášá†áŸ’á¢á¹á„ááŸ’á“á„, áŸášáŸáŸƒ) á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á˜á»áá„á¶ášá‘á¶áŸ†á„á¢áŸáŸ‹áŸ” áœá¶áŠá¼á…á‡á¶á˜á‡áŸ’áˆá˜ááŸ’áŒá›á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„!" },
            { q: "ášá¶á„á€á¶á™á˜á¶á“á”áŸ’ášá–áŸá“áŸ’á’áŸášá¸ášá¶á„áŸ’á‚á”áŸ‰á»á“áŸ’á˜á¶á“?", a: "ášá¶á„á€á¶á™á˜á“á»áŸáŸ’áŸá˜á¶á“á”áŸ’ášá–áŸá“áŸ’á’áŸášá¸ášá¶á„áŸ’á‚áŸáŸ†áá¶á“áŸ‹ 11 á’áŸ’áœá¾á€á¶ášá‡á¶á˜á½á™á‚áŸ’á“á¶áŠá¾á˜áŸ’á”á¸ášá€áŸ’áŸá¶á¢áŸ’á“á€á±áŸ’á™ášáŸáŸ‹á“á·á„á˜á¶á“áŸá»áá—á¶á–á›áŸ’á¢áŸ”" }
        ]
    };
    
    const questions = suggestedQuestions[state.lang];
    
    return `
        <div class="card">
            <button class="btn btn-secondary mb-2" onclick="navigate('home')">â† ${t('back')}</button>
            <h1 class="card-title">${t('ai_coach')}</h1>
            <p class="text-muted mb-3">${t('ai_desc')}</p>
            
            <h2 class="card-subtitle">${t('suggested_questions')}:</h2>
            <div style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1.5rem;">
                ${questions.map((item, idx) => `
                    <button class="btn btn-secondary" style="text-align: left; justify-content: flex-start;" onclick="answerSuggestedQuestion(${idx})">
                        ğŸ’¡ ${item.q}
                    </button>
                `).join('')}
            </div>
            
            <div id="ai-answer" style="display: none;"></div>
            
            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(148, 163, 184, 0.2);">
                <p style="font-size: 0.9rem; color: var(--text-muted);">
                    âš ï¸ ${t('requires_internet')}
                </p>
            </div>
        </div>
    `;
}

function answerSuggestedQuestion(idx) {
    const questions = state.lang === 'en' ? [
        { q: "What is a limit in calculus?", a: "A limit describes the value a function approaches as the input gets closer to a certain point. It's about the journey (approaching), not the destination (exact point)." },
        { q: "How do I calculate probability?", a: "Use this formula: P(Event) = Favorable outcomes / Total outcomes. Example: Rolling a die, P(even) = 3/6 = 1/2." },
        { q: "What are the main parts of the brain?", a: "The brain has 3 main parts: Cerebrum (thinking, memory), Cerebellum (movement, balance), Brainstem (automatic functions like breathing)." },
        { q: "Which system controls the body?", a: "The nervous system (brain, spinal cord, nerves) controls all body functions. It's like the command center!" },
        { q: "How many organ systems does the body have?", a: "The human body has 11 major organ systems working together to keep you alive and healthy." }
    ] : [
        { q: "Limit á€áŸ’á“á»á„ calculus á‚áºá‡á¶á¢áŸ’áœá¸?", a: "Limit á–ááŸŒá“á¶á¢áŸ†á–á¸áá˜áŸ’á›áŸƒáŠáŸ‚á›á¢á“á»á‚á˜á“áŸáá·áá‘áŸ…á‡á·á á“áŸ…á–áŸá› input áá·áá‘áŸ…á‡á·áá…áŸ†áá»á…á˜á½á™áŸ” áœá¶á™á€á…á·ááŸ’áá‘á»á€áŠá¶á€áŸ‹á›á¾áŠáŸ†áá¾ášá€á¶áš á˜á·á“á˜áŸ‚á“á‚áŸ„á›áŠáŸ…á‘áŸáŸ”" },
        { q: "á’áŸ’áœá¾áŠá¼á…á˜áŸ’ááŸá…á‚áá“á¶ probability?", a: "á”áŸ’ášá¾ášá¼á”á˜á“áŸ’áá“áŸáŸ‡: P(á–áŸ’ášá¹ááŸ’áá·á€á¶ášááŸ) = á›á‘áŸ’á’á•á›á¢áŸ†ááŸ„á™á•á› / á›á‘áŸ’á’á•á›áŸášá»á”áŸ” á§á‘á¶á ášááŸ: á‚á”áŸ‹á‚á¼á, P(á‚á¼) = 3/6 = 1/2áŸ”" },
        { q: "á•áŸ’á“áŸ‚á€áŸáŸ†áá¶á“áŸ‹á“áŸƒáá½ášá€áŸ’á”á¶á›á‚áºá‡á¶á¢áŸ’áœá¸?", a: "áá½ášá€áŸ’á”á¶á›á˜á¶á“á•áŸ’á“áŸ‚á€áŸáŸ†áá¶á“áŸ‹ 3: áá½ášá€áŸ’á”á¶á›á’áŸ† (á€á¶ášá‚á·á, á€á¶ášá…á„á…á¶áŸ†), áá½ášá€áŸ’á”á¶á›áá¼á… (á…á›á“á¶, áá»á›áŸ’á™á—á¶á–), áŠá¾á˜áá½ášá€áŸ’á”á¶á› (á˜á»áá„á¶ášáŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá·áŠá¼á…á‡á¶á€á¶ášáŠá€áŠá„áŸ’á á¾á˜)áŸ”" },
        { q: "á”áŸ’ášá–áŸá“áŸ’á’áá¶á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„ášá¶á„á€á¶á™?", a: "á”áŸ’ášá–áŸá“áŸ’á’áŸášáŸáŸƒá”áŸ’ášáŸá¶á‘ (áá½ášá€áŸ’á”á¶á›, ááŸ’áŸáŸ‚ášá†áŸ’á¢á¹á„ááŸ’á“á„, áŸášáŸáŸƒ) á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á˜á»áá„á¶ášá‘á¶áŸ†á„á¢áŸáŸ‹áŸ” áœá¶áŠá¼á…á‡á¶á˜á‡áŸ’áˆá˜ááŸ’áŒá›á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„!" },
        { q: "ášá¶á„á€á¶á™á˜á¶á“á”áŸ’ášá–áŸá“áŸ’á’áŸášá¸ášá¶á„áŸ’á‚á”áŸ‰á»á“áŸ’á˜á¶á“?", a: "ášá¶á„á€á¶á™á˜á“á»áŸáŸ’áŸá˜á¶á“á”áŸ’ášá–áŸá“áŸ’á’áŸášá¸ášá¶á„áŸ’á‚áŸáŸ†áá¶á“áŸ‹ 11 á’áŸ’áœá¾á€á¶ášá‡á¶á˜á½á™á‚áŸ’á“á¶áŠá¾á˜áŸ’á”á¸ášá€áŸ’áŸá¶á¢áŸ’á“á€á±áŸ’á™ášáŸáŸ‹á“á·á„á˜á¶á“áŸá»áá—á¶á–á›áŸ’á¢áŸ”" }
    ];
    
    const item = questions[idx];
    document.getElementById('ai-answer').innerHTML = `
        <div class="feedback correct">
            <div class="feedback-title">ğŸ¤– ${t('answer')}:</div>
            <p style="font-size: 1.05rem; line-height: 1.7; margin-top: 0.75rem;">${item.a}</p>
        </div>
    `;
    document.getElementById('ai-answer').style.display = 'block';
    document.getElementById('ai-answer').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// ==================== NAVIGATION ====================
function navigate(screen) {
    state.currentScreen = screen;
    render();
}

function toggleLang() {
    state.lang = state.lang === 'en' ? 'km' : 'en';
    save();
    render();
}

function showXP(amount) {
    const popup = document.getElementById('xp-popup');
    popup.textContent = `+${amount} XP`;
    popup.classList.add('show');
    setTimeout(() => popup.classList.remove('show'), 1500);
}

// ==================== RENDER ====================
function render() {
    const app = document.getElementById('app');
    let html = '';
    
    if (state.surveyDone) {
        html += `
            <div class="header">
                <div class="logo"><span>ğŸ“</span> <span>KruAI</span></div>
                <div class="header-right">
                    <button class="lang-toggle" onclick="toggleLang()">${state.lang === 'en' ? 'KM' : 'EN'}</button>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value">${state.xp}</div>
                            <div class="stat-label">XP</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${state.streak}ğŸ”¥</div>
                            <div class="stat-label">${state.streak === 1 ? t('day_streak') : t('days_streak')}</div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    if (!state.surveyDone) {
        html += renderSurvey();
    } else {
        switch (state.currentScreen) {
            case 'home': html += renderHome(); break;
            case 'learning': html += renderLearning(); break;
            case 'exam': html += renderMockExam(); break;
            case 'ai-coach': html += renderAICoach(); break;
            default: html += `<div class="card"><p>Coming soon!</p></div>`;
        }
        
        if (state.currentScreen !== 'learning' && state.currentScreen !== 'exam') {
            html += `
                <nav class="bottom-nav">
                    <button class="nav-item ${state.currentScreen === 'home' ? 'active' : ''}" onclick="navigate('home')">
                        <span class="nav-icon">ğŸ </span>
                        <span class="nav-label">${t('nav_home')}</span>
                    </button>
                    <button class="nav-item" onclick="navigate('ai-coach')">
                        <span class="nav-icon">ğŸ¤–</span>
                        <span class="nav-label">AI Coach</span>
                    </button>
                    <button class="nav-item" onclick="alert('Coming in next update!')">
                        <span class="nav-icon">ğŸ—‚ï¸</span>
                        <span class="nav-label">${t('nav_cards')}</span>
                    </button>
                    <button class="nav-item" onclick="navigate('exam')">
                        <span class="nav-icon">ğŸ“</span>
                        <span class="nav-label">${t('nav_exam')}</span>
                    </button>
                    <button class="nav-item" onclick="alert('Coming in next update!')">
                        <span class="nav-icon">â‹¯</span>
                        <span class="nav-label">${t('nav_more')}</span>
                    </button>
                </nav>
            `;
        }
    }
    
    app.innerHTML = html;
}

// ==================== INIT ====================
window.addEventListener('DOMContentLoaded', () => {
    load();
    render();
});
